[build-workspace]
description = "Build the entire workspace"
run = "cargo build --workspace"

[build-persistence]
description = "Build the persistence crate"
run = "cargo build -p roro_persistence"

[build-domain]
description = "Build the domain crate"
run = "cargo build -p roro_domain"

[build-core]
description = "Build the core crate"
run = "cargo build -p roro_core"

[build-assets]
description = "Build all GUI assets (icons and Tailwind CSS)"
depends = ["icons-build", "tailwind-build"]

[build-gui]
description = "Build the GUI crate"
depends = ["build-assets"]
run = "cargo build -p roro_gui"

[run-gui]
description = "Run the GUI crate"
depends = ["build-assets"]
run = "cargo run -p roro_gui"

[backlog-server]
description = "Start the backlog.md browser interface server"
run = "mise exec -- backlog browser"

[icons-install]
description = "Install icon dependencies (heroicons, sharp, png2icons)"
run = "cd icons && npm install"

[tailwind-install]
description = "Install Tailwind CSS dependencies (tailwindcss, postcss, vite, autoprefixer)"
run = "cd tailwind && npm install"

[tailwind-build]
description = "Build Tailwind CSS and output compiled CSS to gui/assets/tailwind.css"
run = "cd tailwind && npm run build"

[icons-clean]
description = "Remove generated icon files from dist directory"
run = "cd icons && rm -rf dist"

[icons-build-heroicons]
description = "Copy Heroicons to GUI assets directory"
run = "cd icons && node scripts/copy-icons.js"

[icons-build-branding]
description = "Generate platform-specific icons from SVG source"
run = "cd icons && node scripts/build.mjs"

[icons-build]
description = "Build all icons (branding and heroicons)"
depends = ["icons-build-branding", "icons-build-heroicons"]

[icons-verify]
description = "Verify all generated icon files exist and are valid"
run = "cd icons && node scripts/verify.mjs"

[icons-watch]
description = "Watch mode for icon builds (re-runs icon build on changes to icon scripts or source files)"
run = "cd icons && while true; do node scripts/copy-icons.js; sleep 2; done"

[tailwind-watch]
description = "Watch mode for Tailwind CSS builds using Vite's watch mode"
run = "cd tailwind && npx vite build --watch"

[assets-watch]
description = "Watch mode for both icons and Tailwind CSS (runs both watch tasks in parallel)"
run = "mise run icons-watch & mise run tailwind-watch & wait"

[fmt-check]
description = "Check that code is properly formatted without making changes"
run = "cargo fmt -- --check"

[fmt]
description = "Format all Rust code"
run = "cargo fmt"

[clippy]
description = "Run clippy linter and deny all warnings"
run = "cargo clippy --all-targets --all-features -- -D warnings"

[test]
description = "Run all tests"
run = "cargo test"

[quality]
description = "Run all quality checks (formatting, linting, tests, npm audits, file size checks)"
depends = ["build-assets"]
run = "bash .mise/shell/quality.sh"

[npm-audit]
description = "Run npm audit for all Node.js projects (icons and tailwind)"
run = "bash .mise/shell/npm-audit.sh"

[file-size-check]
description = "Check for Rust source files over 200 lines and warn about refactoring needs"
run = "bash .mise/shell/file-size-check.sh"
